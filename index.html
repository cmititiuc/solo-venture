<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Against the Chaos Hordes</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    svg { border: 1px solid teal; }
    .tile {
      fill: #ffffff;
      fill-opacity: 1;
      stroke: #cfcfcf;
      stroke-width: 1;
      stroke-linecap: butt;
      stroke-linejoin: miter;
      stroke-miterlimit: 4;
      stroke-opacity: 1;
      stroke-dasharray: none;
      stroke-dashoffset: 0;
      display: inline;
    }
    .tile:hover {
      stroke: #ff0000;
      fill: #ffcccc;
    }
    circle:hover {
      stroke: #000099;
      fill-opacity: 1;
      fill: #CCCCFF;
    }
  </style>
  <script>
    var map = [
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1 ],
      [ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1 ],
      [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1 ],
      [ 1, 0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 0, 1, 1, 0, 0, 0 ],
      [ 1, 2, 2, 2, 2, 3, 3, 3, 3, 0, 0, 0, 1, 1, 0, 0, 0 ],
      [ 1, 2, 2, 2, 2, 3, 3, 3, 3, 0, 0, 0, 1, 1, 0, 0, 0 ],
      [ 1, 2, 2, 2, 2, 3, 3, 3, 3, 0, 0, 0, 1, 1, 0, 0, 0 ],
      [ 1, 2, 2, 4, 2, 3, 3, 4, 3, 0, 0, 0, 1, 1, 0, 0, 0 ],
      [ 1, 1, 1, 4, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 0, 0, 0 ]
    ]

    var viewportWidth, viewportHeight;
    var tileWidth = 30, tileHeight = 30;

    function makeRectangle(x, y) {
      var svgns = "http://www.w3.org/2000/svg";
      var svgDocument = document.getElementById('viewport').ownerDocument;

      var shape = svgDocument.createElementNS(svgns, "rect");
      shape.setAttributeNS(null, "x",
        viewportWidth / 2 - tileWidth * (map[0].length / 2) + tileWidth * x);
      shape.setAttributeNS(null, "y",
        viewportHeight / 2 - tileHeight * (map.length / 2) + tileHeight * y);
      shape.setAttributeNS(null, "width",  tileWidth);
      shape.setAttributeNS(null, "height", tileHeight);
      shape.setAttributeNS(null, "class", "tile");
      shape.setAttributeNS(null, "id", "tile-" + x + "-" + y);
      
      document.getElementById('viewport').appendChild(shape);
    }

    function makeUnit(x, y) {
      var svgns = "http://www.w3.org/2000/svg";
      var svgDocument = document.getElementById('viewport').ownerDocument;
      var targetTile = document.getElementById('tile-' + x + '-' + y);
      var cx = targetTile.x.baseVal.value;
      var cy = targetTile.y.baseVal.value;

      var shape = svgDocument.createElementNS(svgns, "circle");
      shape.setAttributeNS(null, "cx", cx + tileWidth / 2);
      shape.setAttributeNS(null, "cy", cy + tileHeight / 2);
      shape.setAttributeNS(null, "r", "10");
      shape.setAttributeNS(null, "fill-opacity", "1");
      shape.setAttributeNS(null, "fill", '#c66666');
      shape.setAttributeNS(null, "stroke-width", "2");
      shape.setAttributeNS(null, "stroke", "maroon");
      // shape.setAttributeNS(null, "class", "");
      shape.setAttributeNS(null, "id", "player");

      document.getElementById('viewport').appendChild(shape);
    }

    function moveUnit(id, x, y) {
      var unit = document.getElementById(id);
      var targetTile = document.getElementById('tile-' + x + '-' + y);
      var cx = targetTile.x.baseVal.value;
      var cy = targetTile.y.baseVal.value;
      unit.setAttributeNS(null, "cx", cx + tileWidth / 2);
      unit.setAttributeNS(null, "cy", cy + tileHeight / 2);
    }

    // from en.wikipedia.org/wiki/Breadth-first_search#Pseudocode
    function bfs(x, y) {
      var targetTile = document.getElementById('tile-' + x + '-' + y);
      var q = [];
      q.push([x, y]);
      targetTile.style.stroke = "green";
      targetTile.style.fill = "#CCFFCC";
      while(q.length !== 0) {
        var v = q.shift();
        targetTile = document.getElementById('tile-' + v[0] + '-' + v[1]);
        // north
        if (targetTile = document.getElementById('tile-' + v[0] + '-' + (v[1] - 1))) {
          if (targetTile.style.stroke !== "green") {
            q.push([v[0], v[1] - 1]);
            targetTile.style.stroke = "green";
            targetTile.style.fill = "#CCFFCC";
          }
        }
        // south
        if (targetTile = document.getElementById('tile-' + v[0] + '-' + (v[1] + 1))) {
          if (targetTile.style.stroke !== "green") {
            q.push([v[0], v[1] + 1]);
            targetTile.style.stroke = "green";
            targetTile.style.fill = "#CCFFCC";
          }
        }
        // east
        if (targetTile = document.getElementById('tile-' + (v[0] + 1) + '-' + v[1])) {
          if (targetTile.style.stroke !== "green") {
            q.push([v[0] + 1, v[1]]);
            targetTile.style.stroke = "green";
            targetTile.style.fill = "#CCFFCC";
          }
        }
        // west
        if (targetTile = document.getElementById('tile-' + (v[0] - 1) + '-' + v[1])) {
          if (targetTile.style.stroke !== "green") {
            q.push([v[0] - 1, v[1]]);
            targetTile.style.stroke = "green";
            targetTile.style.fill = "#CCFFCC";
          }
        }
      }
    }

    // slowed down version of bfs with range
    function bfsSlow(x, y, range = 5) {
      var targetTile = document.getElementById('tile-' + x + '-' + y);
      var q = [];
      q.push([x, y, 0]);
      targetTile.style.stroke = "green";
      targetTile.style.fill = "#CCFFCC";
      (function step() {
        if (q.length !== 0) {
          var v = q.shift(), id;
          // north
          id = 'tile-' + v[0] + '-' + (v[1] - 1);
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && v[2] < range) {
              q.push([v[0], v[1] - 1, v[2] + 1]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // south
          id = 'tile-' + v[0] + '-' + (v[1] + 1);
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && v[2] < range) {
              q.push([v[0], v[1] + 1, v[2] + 1]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // east
          id = 'tile-' + (v[0] + 1) + '-' + v[1];
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && v[2] < range) {
              q.push([v[0] + 1, v[1], v[2] + 1]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // west
          id = 'tile-' + (v[0] - 1) + '-' + v[1];
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && v[2] < range) {
              q.push([v[0] - 1, v[1], v[2] + 1]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          setTimeout(step, 250);
        }
      })();
    }

    function drawShortestPath(x1, y1, x2, y2) {
      makeUnit(x1, y1);
      makeUnit(x2, y2);
      var targetTile = document.getElementById('tile-' + x1 + '-' + y1);
      var q = [];
      var found = false;
      q.push([x1, y1, []]);
      targetTile.style.stroke = "green";
      targetTile.style.fill = "#CCFFCC";
      (function step() {
        if (q.length !== 0) {
          var v = q.shift(), id;
          if (v[0] == x2 && v[1] == y2) {
            found = true;
            console.log(v[2]);
            for (var i = 0; i < v[2].length; i++) {
              var id = 'tile-' + v[2][i][0] + '-' + v[2][i][1];
              targetTile = document.getElementById(id);
              targetTile.style.stroke = "blue";
              targetTile.style.fill = "#CCCCFF";
            }
            var id = 'tile-' + x2 + '-' + y2;
            targetTile = document.getElementById(id);
            targetTile.style.stroke = "blue";
            targetTile.style.fill = "#CCCCFF";
          }
          // north
          id = 'tile-' + v[0] + '-' + (v[1] - 1);
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && found == false) {
              console.log(v[2]);
              var h = [].concat(v[2]);
              h.push([ v[0], v[1] ]);
              q.push([ v[0], v[1] - 1, h ]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // south
          id = 'tile-' + v[0] + '-' + (v[1] + 1);
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && found == false) {
              console.log(v[2]);
              var h = [].concat(v[2]);
              h.push([ v[0], v[1] ]);
              q.push([v[0], v[1] + 1, h ]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // east
          id = 'tile-' + (v[0] + 1) + '-' + v[1];
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && found == false) {
              console.log(v[2]);
              var h = [].concat(v[2]);
              h.push([ v[0], v[1] ]);
              q.push([v[0] + 1, v[1], h ]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          // west
          id = 'tile-' + (v[0] - 1) + '-' + v[1];
          if (targetTile = document.getElementById(id)) {
            if (targetTile.style.stroke !== "green" && found == false) {
              console.log(v[2]);
              var h = [].concat(v[2]);
              h.push([ v[0], v[1] ]);
              q.push([v[0] - 1, v[1], h ]);
              targetTile.style.stroke = "green";
              targetTile.style.fill = "#CCFFCC";
            }
          }
          setTimeout(step, 250);
        }
      })();
    }

    function init() {
      var viewport = document.getElementById('viewport');
      viewportWidth = viewport.width.baseVal.value;
      viewportHeight = viewport.height.baseVal.value;
      
      // draw tiles
      for (var i = 0; i < map.length; i++) {
        for (var j = 0; j < map[0].length; j++) {
          if (map[i][j] != 0) {
            makeRectangle(j, i);
          }
        }
      }
      
      // draw player
      makeUnit(0, 0);
      
      var tiles = document.getElementsByClassName('tile');
      for (var i = 0; i < tiles.length; i++) {
        tiles[i].addEventListener('click', function() {
          var x = this.id.match(/[0-9]+/);
          var y = this.id.match(/[0-9]+$/);
          moveUnit('player', x, y);
        }, false);
      }
    }
  </script>
</head>

<body onload="init();">

  <!--[if lt IE 8]>
  <p class="browserupgrade">
    You are using an <strong>outdated</strong> browser. Please
    <a href="http://browsehappy.com/">upgrade your browser</a> to improve your
    experience.</p>
  <![endif]-->

  <p>Against the Chaos Hordes</p>

  <svg id="viewport"
       xmlns:xlink="http://www.w3.org/2000/svg"
       version="1.1"
       width="800"
       height="600">
  </svg>

</body>

</html>
